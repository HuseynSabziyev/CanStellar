@{
    ViewData["Title"] = "Home Page";
}

@*@section scripts {
    <script>
        $(document).ready(function () {
            
            $("#sendButton").click(function () {
                console.log("TelemetryFunc function");
                TelemetryFunc();
            });
            function TelemetryFunc() {
                $.post("/Home/TelemetryFunc")
                    .done(function () {
                        console.log("TelemetryFunc function called successfully.");
                    })
                    .fail(function (error) {
                        console.log(error);
                    });
            }
        });
    </script>
}*@


@using Microsoft.AspNetCore.Mvc.TagHelpers
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@using CanStellarBack.Models
@model List<Telemetry>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/index.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <title>GCS Interface</title>
</head>
<body>
    <div id="header" class="container-fluid">
        <img id="logo" src="./assets/canstellarlogo.png" alt="">
        <h2>CanStellar Ground Station Interface</h2>
        <a id="sendButton" class="btn btn-warning">Start telemetry receiving process!</a>
        <a id="setTime" class="btn btn-success">Set time</a>
        <a id="simControl" class="btn btn-success">Simulation mode</a> @*needs work*@
        <a id="simPressure" class="btn btn-success">Simulation pressure</a> @*needs work*@
        <a id="calAltitude" class="btn btn-primary">Calibrate altitude</a>
        <a id="controlAudio" class="btn btn-success">Control audio</a> @*needs work*@
        <a id="stopButton" class="btn btn-danger">STOP!</a>

    </div>

    <div id="main" class="container-fluid">
        <div id="databox" class="container-sm display-flex flex-direction-column">
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@@microsoft/signalr@7.0.5/dist/browser/signalr.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#sendButton").click(function () {
                $.ajax({
                    url: "/Home/TelemetryFunc",
                    type: "POST",
                    success: function () {
                        console.log("Program started successfully.");
                    },
                    error: function (xhr, status, error) {
                        console.error("Error starting the program:", error);
                        <a href="C:\Users\V-COMP\Desktop\CanStellar\YIS\CanStellarBack\CanStellarBack\Controllers\HomeController.cs">C:\Users\V-COMP\Desktop\CanStellar\YIS\CanStellarBack\CanStellarBack\Controllers\HomeController.cs</a>
                    },
                });
            });
        });

        $(document).ready(function () {
            $("#setTime").click(function () {
                $.ajax({
                    url: "/Home/SetTime",
                    type: "POST",
                    success: function () {
                        console.log("Program started successfully.");
                    },
                    error: function (xhr, status, error) {
                        console.error("Error starting the program:", error);
                    },
                });
            });
        });

        $(document).ready(function () {
            $("#simControl").click(function () {
                $.ajax({
                    url: "/Home/SetTime",
                    type: "POST",
                    success: function () {
                        console.log("Program started successfully.");
                    },
                    error: function (xhr, status, error) {
                        console.error("Error starting the program:", error);
                    },
                });
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            $("#stopButton").click(function () {
                $.ajax({
                    url: "/Home/StopProgram",
                    type: "POST",
                    success: function (response) {
                        console.log("Program stopped successfully.");
                      
                    },
                    error: function (xhr, status, error) {
                        console.error("Error stopping the program:", error);
                        
                    }
                });
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            var connection = new signalR.HubConnectionBuilder()
                .withUrl("/telemetryHub")
                .build();
            connection.start()
                .then(function () {
                    console.log("SignalR connection established.");
                    console.log("SignalR connection ID: " + connection.connectionId);
                })
                .catch(function (err) {
                    console.error(err.toString());
                });
            var counter = 1;
            connection.on("ReceiveTelemetryData", function (telemetry) {
                console.log("Received telemetry data:", telemetry);
                var telemetryDataContainer = $("#databox");
                
                var telemetryData =
                    '<div id="tele-data">' +
                    '<p id="raw-telemetric-data">' + counter+'. Raw Telemetry ' + telemetry.raw + '</p>' +
                    '<h6>Detailed telemetry:</h6>' +
                    '<ol id="telemetric-data-list">' +
                    '<li><p>Team ID: ' + telemetry.teamId + '</p></li>' +
                    '<li><p>Mission Time: ' + telemetry.missionTime + ' </p></li>' +
                    '<li><p>Packet Count: ' + telemetry.packetCount + ' </p></li>' +
                    '<li><p>State: ' + telemetry.state + '</p></li>' +
                    '<li><p>Altitude: ' + telemetry.altitude + ' m</p></li>' +
                    '<li><p>Air Speed: ' + telemetry.speed + ' m/s</p></li>' +
                    '<li><p>HS_DEPLOYED: ' + telemetry.HS_DEPLOYED + '</p></li>' +
                    '<li><p>PC_DEPLOYED: ' + telemetry.PC.DEPLOYED + '</p></li>' +
                    '<li><p>Temperature: ' + telemetry.temperature + '</p></li>' +
                    '<li><p>Pressure: ' + telemetry.pressure + ' </p></li>' +
                    '<li><p>Voltage: ' + telemetry.voltage + ' V</p></li>' +
                    '<li><p>GPS Time: ' + telemetry.GPS_Time + ' </p></li>' +
                    '<li><p>GPS Altitude: ' + telemetry.GPS_Altitude + ' m</p></li>' +
                    '<li><p>GPS_Latitude: ' + telemetry.GPS_Latitude + ' </p></li>' +
                    '<li><p>GPS_Longitude: ' + telemetry.GPS_Longitude + ' </p></li>' +
                    '<li><p>GPS_Sats: ' + telemetry.GPS_Sats + ' </p></li>' +
                    '<li><p>Tilt X: ' + telemetry.Tilt_X + ' </p></li>' +
                    '<li><p>Tilt Y: ' + telemetry.Tilt_Y + ' </p></li>' +
                    '<li><p>Rotation Z: ' + telemetry.Rot_Z + ' </p></li>' +
                    '<li><p>CMD Echo: ' + telemetry.CMD_ECHO + ' </p></li>' +
                    '<li><p>Note: ' + telemetry.Note + ' </p></li>' +
                    '</ol>' +
                    '</div>';
                telemetryDataContainer.prepend(telemetryData);
                counter++;
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
</body>
</html>
